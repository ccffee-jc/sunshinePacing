# 技术设计: 回包日志与配置开关

## 技术方案
### 核心技术
- Go 标准库 log
- YAML 配置加载（gopkg.in/yaml.v3）

### 实现要点
- 在配置中新增 response_log.enable 字段，默认关闭。
- 内部→外部转发路径在每个包发送后记录日志。
- 日志内容包含流类型、端口、包大小、来源/目标地址、协议等。

## 架构决策 ADR
### ADR-005: 回包日志默认关闭
**上下文:** 逐包日志对排障有帮助，但会产生高频日志。
**决策:** 增加配置开关，默认关闭。
**理由:** 平衡可观测性与性能。
**替代方案:** 默认开启 → 拒绝原因: 性能与日志噪音不可接受。
**影响:** 配置与文档需同步更新。

## 安全与性能
- **安全:** 日志不记录敏感内容，仅包含网络元数据。
- **性能:** 启用时有明显开销，建议短时间排障使用。

## 测试与部署
- **测试:** 运行 go test ./...；手动验证回包日志触发。
- **部署:** 修改 proxy.yml 开启 response_log.enable。
