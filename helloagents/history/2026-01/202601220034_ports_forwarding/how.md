# 技术设计: Sunshine 全端口转发支持

## 技术方案
### 核心技术
- Go 标准库 net（TCP/UDP 监听与转发）

### 实现要点
- 扩展端口映射：基于 base_port + offset 计算端口表，支持 UDP/TCP 类型
- UDP: 维持现有 video/control/audio 的 pacing/转发逻辑；其他 UDP 端口走纯转发
- TCP: 新增 listener → accept → 双向拷贝的转发通道，内部按 base_port + offset 连接 Sunshine
- 端口表默认全开，兼容 Moonlight 文档中的 UDP 48010

## 架构决策 ADR
### ADR-001: 端口表内置 + TCP 转发支持
**上下文:** Sunshine 端口由 base_port 派生，用户无法逐一配置。当前仅转发 3 个 UDP 端口，导致其他功能不可用。
**决策:** 内置官方端口偏移表（含 UDP 48010 兼容），新增 TCP 转发模块，默认全开。
**理由:** 保持用户配置简单，功能覆盖完整，兼容主流客户端文档差异。
**替代方案:** 全部端口配置化 → 拒绝原因: 配置复杂、易错、不符合“单一 base_port”目标。
**影响:** 新增 TCP 资源管理与测试开销；需要补充端口表文档。

## 安全与性能
- **安全:** 仅转发内部 Sunshine 端口；避免记录敏感数据；端口绑定保持可控
- **性能:** TCP 转发使用 io.Copy 双向管道，设置合理超时；UDP 仍为无锁转发路径

## 测试与部署
- **测试:** 补充端口映射单测；新增 TCP 端口转发基础测试（本地回环）
- **部署:** 不变，默认全开
